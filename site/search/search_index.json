{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"scRNA-seq on WT and Tg CD45hi cells from brain Experiment Protocol The experiment protocol information is available in this PDF document The Run information is available in this PDF document Data Analysis Workflow Primary Analysis Quality Control Normalization Clustering Differential Expression Analysis Cell-type Specific Response Analysis Annotation Scripts All the below scripts used for this analysis are available in the Tools folder; Project Folder Structure/Contents The project folder scRNAseqNilisha has the following subfolders and relevant contents as noted below; Archive : Old/unwanted files are stored in this folder, for backup purpose index.html : The main page to all project documentation Protocol : Contains experiment/protocol details RawData : Contains all the raw data obtained from the sequencing core Reports : Contains all the reports, including this documentation Results : Contains all the results Tools : Contains all the scripts and reference files","title":"Home"},{"location":"index.html#scrna-seq-on-wt-and-tg-cd45hi-cells-from-brain","text":"","title":"scRNA-seq on WT and Tg CD45hi cells from brain"},{"location":"index.html#experiment-protocol","text":"The experiment protocol information is available in this PDF document The Run information is available in this PDF document","title":"Experiment Protocol"},{"location":"index.html#data-analysis-workflow","text":"Primary Analysis Quality Control Normalization Clustering Differential Expression Analysis Cell-type Specific Response Analysis Annotation","title":"Data Analysis Workflow"},{"location":"index.html#scripts","text":"All the below scripts used for this analysis are available in the Tools folder;","title":"Scripts"},{"location":"index.html#project-folder-structurecontents","text":"The project folder scRNAseqNilisha has the following subfolders and relevant contents as noted below; Archive : Old/unwanted files are stored in this folder, for backup purpose index.html : The main page to all project documentation Protocol : Contains experiment/protocol details RawData : Contains all the raw data obtained from the sequencing core Reports : Contains all the reports, including this documentation Results : Contains all the results Tools : Contains all the scripts and reference files","title":"Project Folder Structure/Contents"},{"location":"annotation.html","text":"E. Software F. Reference","title":"Annotation"},{"location":"annotation.html#e-software","text":"","title":"E. Software"},{"location":"annotation.html#f-reference","text":"","title":"F. Reference"},{"location":"cell-type-specific-response.html","text":"E. Software F. Reference","title":"Cell type specific response"},{"location":"cell-type-specific-response.html#e-software","text":"","title":"E. Software"},{"location":"cell-type-specific-response.html#f-reference","text":"","title":"F. Reference"},{"location":"clustering.html","text":"E. Software F. Reference","title":"Clustering"},{"location":"clustering.html#e-software","text":"","title":"E. Software"},{"location":"clustering.html#f-reference","text":"","title":"F. Reference"},{"location":"differential-expression.html","text":"E. Software F. Reference","title":"Differential Expression"},{"location":"differential-expression.html#e-software","text":"","title":"E. Software"},{"location":"differential-expression.html#f-reference","text":"","title":"F. Reference"},{"location":"normalization.html","text":"E. Software F. Reference","title":"Normalization"},{"location":"normalization.html#e-software","text":"","title":"E. Software"},{"location":"normalization.html#f-reference","text":"","title":"F. Reference"},{"location":"primary-analysis.html","text":"A. Prepare samplesheet.csv file Current samplesheet.csv file is a comma separated text file. This file could be edited in a plain text editor or a spreadsheet program. The file content is given below; Lane,Sample,Index *,WT_Gex,SI-GA-C1 *,Tg_Gex,SI-GA-D1 *,WT_Barcode,SI-GA-E1 *,Tg_Barcode,SI-GA-F1 In the Lane column, * specifies all lanes. Sample column specifies sample names. Index column specifies Index used for these samples (this info comes from HS017_Run_info.pdf ) B. Generate fastq files from BCL files (AND Demultiplex at sample level) Login to biowulf and request an interactive node using the below 'sinteractive' command, with 32 cores, 60gb RAM and 300gb of storage; sinteractive --cpus-per-task=32 --mem=60g --gres=lscratch:300 Once the interacive node is assigned, run the below command to load the cellranger module; # Change to the working directory cd /data/Shih_Lab/scRNAseqNilisha # Load the cellranger module module load cellranger After loading the cellranger module, run the below command to generate fastq files; cellranger mkfastq --id=brainfastq --run=RawData/BCL --csv=Protocol/samplesheet.csv --localcores=$SLURM_CPUS_PER_TASK --localmem=34 The mkfastq is the subcommand to generate fastq files from BCL files. --id specifies the 'brainfastq' as a output folder (will be created new) --run specifies the location of the BCL folder that contains the raw BCL and associated files --csv specifies the samplesheet.csv file that we created in step A above --localcores specifies the number of cpus to use - same as that of the interactive node cpus --localmem specifies the 34 GB for memory The mkfastq run takes about one hour to complete. Once the run is complete, the fastq files are available in the outs/fastq_path/HCJY2DRXY/ folder within the output directory specified in the step #3 . A preliminary Report of the flow cell summary and lane summary for each of the sample indexes is available in this html file C. Cell count at individual mouse level Prepare the multiplex_feature_reference.csv file The multiplex_feature_reference.csv is a comman separated text file. The multiplex_feature_reference.csv lists the hash tags (barcodes) used for each mouse. Each mouse is labelled with a unique id (like WT_B1), a name (could be the same as id), read and pattern (which are standard for TotalSeqB protocol tags). The multiplex_feature_rference.csv file for this run is located in the Protocol folder. The contents of multiplex_feature_reference.csv for this run is given below. id,name,read,pattern,sequence,feature_type WT_B1,WT_B1,R2,5PNNNNNNNNNN(BC),ACCCACCAGTAAGAC,Multiplexing Capture WT_B2,WT_B2,R2,5PNNNNNNNNNN(BC),GGTCGAGAGCATTCA,Multiplexing Capture WT_B5,WT_B5,R2,5PNNNNNNNNNN(BC),CTTTGTCTTTGTGAG,Multiplexing Capture WT_B6,WT_B6,R2,5PNNNNNNNNNN(BC),TATGCTGCCACGGTA,Multiplexing Capture Tg_B3,Tg_B3,R2,5PNNNNNNNNNN(BC),CTTGCCGCATGTCAT,Multiplexing Capture Tg_B4,Tg_B4,R2,5PNNNNNNNNNN(BC),AAAGCATTCTTCACG,Multiplexing Capture Tg_B7,Tg_B7,R2,5PNNNNNNNNNN(BC),GAGTCTGCCAGTATC,Multiplexing Capture Tg_B8,Tg_B8,R2,5PNNNNNNNNNN(BC),TATAGAACGCCAGGC,Multiplexing Capture Prepare the multiplex_config_new.csv file The multiplex_config.csv is text file, with three sections (gene-expression, libraries, samples). The gene-expression section has information about the reference genome location, expected number of cells and the hash-tag (cmo-set) reference file (as described in #1 above) location The libraries section describes the fastq files folders for each of the sample The sample section describes the sample ids for each of the mouse (can use the same ids for sample_ids, cmo_ids and description The file used for this analysis is available in the Protocol folder The contents of the multiplex_config.csv file used for this analysis is given below [gene-expression] reference,/fdb/cellranger/refdata-gex-mm10-2020-A expect-cells,6000 cmo-set,/data/Shih_Lab/scRNAseqNilisha/Protocol/multiplex_feature_reference.csv [libraries] fastq_id,fastqs,feature_types WT_Gex,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Gex,Gene Expression Tg_Gex,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Gex,Gene Expression WT_Barcode,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Barcode,Multiplexing Capture Tg_Barcode,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Barcode,Multiplexing Capture [samples] sample_id,cmo_ids,description WT_B1,WT_B1,WT_B1 WT_B2,WT_B2,WT_B2 WT_B5,WT_B5,WT_B5 WT_B6,WT_B6,WT_B6 Tg_B3,Tg_B3,Tg_B3 Tg_B4,Tg_B4,Tg_B4 Tg_B7,Tg_B7,Tg_B7 Tg_B8,Tg_B8,Tg_B8 Login to biowulf and request an interactive node using the below 'sinteractive' command, with 32 cores, 64gb RAM and 300gb of storage; sinteractive --cpus-per-task=32 --mem=64g --gres=lscratch:300 Once the interacive node is assigned, run the below command to load the cellranger module; # Change to the working directory cd /data/Shih_Lab/scRNAseqNilisha # Load the cellranger module module load cellranger After loading the cellranger module, run the below command to generate cell counts; cellranger multi --id=wttgbrain_hto_demultiplexed --csv=Protocol/multiplex_config.csv --jobmode=slurm --maxjobs=25 The multi is the subcommand to demultiplex based on HTO samples. --id specifies the 'wttgbrain_hto_demultiplexed' as a output folder (will be created new) --csv specifies the location of the multiplex_config.csv file (Protocol/multiplex_config.csv) --jobmode=slurm specifies that the job needs to be run in batch mode --maxjobs specifies the number of jobs allowed for this batch run (25 in our run) The cellranger multi runs for a few hours to complete. Once the run is complete, the output files are available in the outs/per_sample_outs folder within the 'wttgbrain_hto_demultiplexed' directory specified in the step #5 . A preliminary Report with the count summary, alignment quality, some preliminary analysis are available in the per_sample_outs folder, within each of the sample folders. For example, this web_summary.html file is available in the per_sample_outs/Tg_B3 folder The matrix files that we will use in the downstream analysis in seurat is also available in the per samples folder. D. Cell count at sample level Prepare libraryTG.csv and libraryWT.csv files (these are comma separated text files) The libraryTG.csv describes the location of the fastq files folder for the TG sample, the corresponding sample types (Tg) and the library preparation type (gene expression or antibody capture) The libraryTG.csv for this run is located here in the Protocol folder Similarly, prepare the libraryWT.csv file for the WT sample. The contents of the libraryTG.csv file and libraryWT.csv are given below. Note Since we are going to the data only at the samples level (wt vs tg), we do not have to include the antibody capture information in this run, but we are including it just in case. fastqs,sample,library_type /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Barcode/,WT_Barcode,Antibody Capture /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Gex/,WT_Gex,Gene Expression fastqs,sample,library_type /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Barcode/,Tg_Barcode,Antibody Capture /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Gex/,Tg_Gex,Gene Expression 2. Prepare a common feature_reference.csv file(this is a comma separated text file) The feature_reference.csv file describes the antibodies (hash tag) used to hash tag the individual mouse (like B1, B2 etc.), a name for the individual mouse (like WT_B1), and then the pattern R2,5PNNNNNNNNNN(BC) (this is specific to TotalSeq B protocol , the actual Tag barcode sequence and the feature type (antibody capture) The feature_reference.csv for this run is located here in the Protocol folder The contents of the feature_reference.csv file is given below. id,name,read,pattern,sequence,feature_type WT_B1,WT_B1,R2,5PNNNNNNNNNN(BC),ACCCACCAGTAAGAC,Antibody Capture WT_B2,WT_B2,R2,5PNNNNNNNNNN(BC),GGTCGAGAGCATTCA,Antibody Capture WT_B5,WT_B5,R2,5PNNNNNNNNNN(BC),CTTTGTCTTTGTGAG,Antibody Capture WT_B6,WT_B6,R2,5PNNNNNNNNNN(BC),TATGCTGCCACGGTA,Antibody Capture Tg_B3,Tg_B3,R2,5PNNNNNNNNNN(BC),CTTGCCGCATGTCAT,Antibody Capture Tg_B4,Tg_B4,R2,5PNNNNNNNNNN(BC),AAAGCATTCTTCACG,Antibody Capture Tg_B7,Tg_B7,R2,5PNNNNNNNNNN(BC),GAGTCTGCCAGTATC,Antibody Capture Tg_B8,Tg_B8,R2,5PNNNNNNNNNN(BC),TATAGAACGCCAGGC,Antibody Capture 3. Prepare the swarm file containing the commands for both the samples (WT and TG) This swarm file (saved as count.swarm ) is a text file with the below commands. The swarm file specifies the 'count' subcommand for cellranger, the output folder name (--id), path to the library file (--libraries), path to the reference transcriptome (--transcriptome), path to the feature reference file (--feature-ref), the expected number of cells (--expect-cells), the number of cores to use and the amount of memory to use. cellranger count --id=WTbrain --libraries=/data/Shih_Lab/scRNAseqNilisha/Protocol/libraryWT.csv --transcriptome=/fdb/cellranger/refdata-gex-mm10-2020-A --feature-ref=/data/Shih_Lab/scRNAseqNilisha/Protocol/feature_reference_WT.csv --expect-cells=6000 --localcores=28 --localmem=64 cellranger count --id=TGbrain --libraries=/data/Shih_Lab/scRNAseqNilisha/Protocol/libraryTG.csv --transcriptome=/fdb/cellranger/refdata-gex-mm10-2020-A --feature-ref=/data/Shih_Lab/scRNAseqNilisha/Protocol/feature_reference_TG.csv --expect-cells=6000 --localcores=28 --localmem=64 4. Change to the Tools directory using the below command cd /data/Shih_Lab/scRNAseqNilisha/Tools/ 5. Run the swarm job using the below command, specifying the swarm file name, memory (-g), threads (-t), scratch space (--gres) and the module cellranger; swarm -f count.swarm -g 64 -t 28 --gres=lscratch:200 --module cellranger Note Note down your job id. Check your job status using the \"jobload\" command or the squeue command; Note Replace the job id in the below command with your job id squeue --job 14354599 6. Extend the swarm job running time using the below command; Note Replace the job id in the below command with your job id newwall --jobid 13558558 --time 36:00:00 7. Output The cellranger count runs for a few hours to complete. Once the run is complete, the output files are available in the outs folder within the 'WTbrain' and 'TGbrain' directories specified in the swarm file. In this run we moved the WTbrain and TGbrain results folders to the Results folder . A preliminary Report with the count summary, alignment quality, some preliminary analysis are available in the respective outs folder in the web_summary.html file The respective clustering file (cloupe.cloupe) based on the preliminary analysis is also available in the 'outs' folder, to visualize and explore the t-SNE and UMAP data. The matrix files that we will use in the downstream analysis in seurat is also available in the 'outs' folder. E. Combine Cell counts (using sample level counts), to get a combined loupe file Prepare the aggr.csv file The aggr.csv is a comma separated text file. The aggr.csv lists the sample Id, path to the molecule_h5 file for each of the samples obtained from the Step D above (WT and TG) and the sample group (WT or TG) The aggr.csv file for this run is located in the Tools folder. The contents of aggr.csv for this run is given below. sample_id,molecule_h5,SampleGroup WT,/data/Shih_Lab/scRNAseqNilisha/Results/WTbrain/outs/molecule_info.h5,WT TG,/data/Shih_Lab/scRNAseqNilisha/Results/TGbrain/outs/molecule_info.h5,TG Login to biowulf and request an interactive node using the below 'sinteractive' command, with 32 cores, 64gb RAM and 300gb of storage; sinteractive --cpus-per-task=32 --mem=64g --gres=lscratch:300 Once the interacive node is assigned, run the below command to load the cellranger module; # Change to the working directory cd /data/Shih_Lab/scRNAseqNilisha # Load the cellranger module module load cellranger After loading the cellranger module, run the below command to combine the cell counts from WT and TG and generate the combined loupe file; cellranger aggr --id=WT_TG_combined --csv=Tools/aggr.csv The aggr is the subcommand to combine the sample counts from WT and TG results folders. --id specifies the 'WT_TG' as a output folder (will be created new) --csv specifies the location of the aggr.csv file (Tools/aggr.csv) The cellranger aggr runs for a few hours to complete. Once the run is complete, the output files are available in the outs folder within the 'WT_TG_combined' directory specified in the step #4 above . A preliminary Report with the count summary, alignment quality, some preliminary analysis are available in the web_summary.html file is available in the outs folder The combined loupe file is available in the count folder Software cellranger 6.0.0 R 4.0.5 mkdocs 1.1.2 References fastq generation Demultiplex and count TotalSeq CellRanger Biowulf Swarm Biowulf","title":"Primary Analysis"},{"location":"primary-analysis.html#a-prepare-samplesheetcsv-file","text":"Current samplesheet.csv file is a comma separated text file. This file could be edited in a plain text editor or a spreadsheet program. The file content is given below; Lane,Sample,Index *,WT_Gex,SI-GA-C1 *,Tg_Gex,SI-GA-D1 *,WT_Barcode,SI-GA-E1 *,Tg_Barcode,SI-GA-F1 In the Lane column, * specifies all lanes. Sample column specifies sample names. Index column specifies Index used for these samples (this info comes from HS017_Run_info.pdf )","title":"A. Prepare samplesheet.csv file"},{"location":"primary-analysis.html#b-generate-fastq-files-from-bcl-files-and-demultiplex-at-sample-level","text":"Login to biowulf and request an interactive node using the below 'sinteractive' command, with 32 cores, 60gb RAM and 300gb of storage; sinteractive --cpus-per-task=32 --mem=60g --gres=lscratch:300 Once the interacive node is assigned, run the below command to load the cellranger module; # Change to the working directory cd /data/Shih_Lab/scRNAseqNilisha # Load the cellranger module module load cellranger After loading the cellranger module, run the below command to generate fastq files; cellranger mkfastq --id=brainfastq --run=RawData/BCL --csv=Protocol/samplesheet.csv --localcores=$SLURM_CPUS_PER_TASK --localmem=34 The mkfastq is the subcommand to generate fastq files from BCL files. --id specifies the 'brainfastq' as a output folder (will be created new) --run specifies the location of the BCL folder that contains the raw BCL and associated files --csv specifies the samplesheet.csv file that we created in step A above --localcores specifies the number of cpus to use - same as that of the interactive node cpus --localmem specifies the 34 GB for memory The mkfastq run takes about one hour to complete. Once the run is complete, the fastq files are available in the outs/fastq_path/HCJY2DRXY/ folder within the output directory specified in the step #3 . A preliminary Report of the flow cell summary and lane summary for each of the sample indexes is available in this html file","title":"B. Generate fastq files from BCL files (AND Demultiplex at sample level)"},{"location":"primary-analysis.html#c-cell-count-at-individual-mouse-level","text":"Prepare the multiplex_feature_reference.csv file The multiplex_feature_reference.csv is a comman separated text file. The multiplex_feature_reference.csv lists the hash tags (barcodes) used for each mouse. Each mouse is labelled with a unique id (like WT_B1), a name (could be the same as id), read and pattern (which are standard for TotalSeqB protocol tags). The multiplex_feature_rference.csv file for this run is located in the Protocol folder. The contents of multiplex_feature_reference.csv for this run is given below. id,name,read,pattern,sequence,feature_type WT_B1,WT_B1,R2,5PNNNNNNNNNN(BC),ACCCACCAGTAAGAC,Multiplexing Capture WT_B2,WT_B2,R2,5PNNNNNNNNNN(BC),GGTCGAGAGCATTCA,Multiplexing Capture WT_B5,WT_B5,R2,5PNNNNNNNNNN(BC),CTTTGTCTTTGTGAG,Multiplexing Capture WT_B6,WT_B6,R2,5PNNNNNNNNNN(BC),TATGCTGCCACGGTA,Multiplexing Capture Tg_B3,Tg_B3,R2,5PNNNNNNNNNN(BC),CTTGCCGCATGTCAT,Multiplexing Capture Tg_B4,Tg_B4,R2,5PNNNNNNNNNN(BC),AAAGCATTCTTCACG,Multiplexing Capture Tg_B7,Tg_B7,R2,5PNNNNNNNNNN(BC),GAGTCTGCCAGTATC,Multiplexing Capture Tg_B8,Tg_B8,R2,5PNNNNNNNNNN(BC),TATAGAACGCCAGGC,Multiplexing Capture Prepare the multiplex_config_new.csv file The multiplex_config.csv is text file, with three sections (gene-expression, libraries, samples). The gene-expression section has information about the reference genome location, expected number of cells and the hash-tag (cmo-set) reference file (as described in #1 above) location The libraries section describes the fastq files folders for each of the sample The sample section describes the sample ids for each of the mouse (can use the same ids for sample_ids, cmo_ids and description The file used for this analysis is available in the Protocol folder The contents of the multiplex_config.csv file used for this analysis is given below [gene-expression] reference,/fdb/cellranger/refdata-gex-mm10-2020-A expect-cells,6000 cmo-set,/data/Shih_Lab/scRNAseqNilisha/Protocol/multiplex_feature_reference.csv [libraries] fastq_id,fastqs,feature_types WT_Gex,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Gex,Gene Expression Tg_Gex,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Gex,Gene Expression WT_Barcode,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Barcode,Multiplexing Capture Tg_Barcode,/data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Barcode,Multiplexing Capture [samples] sample_id,cmo_ids,description WT_B1,WT_B1,WT_B1 WT_B2,WT_B2,WT_B2 WT_B5,WT_B5,WT_B5 WT_B6,WT_B6,WT_B6 Tg_B3,Tg_B3,Tg_B3 Tg_B4,Tg_B4,Tg_B4 Tg_B7,Tg_B7,Tg_B7 Tg_B8,Tg_B8,Tg_B8 Login to biowulf and request an interactive node using the below 'sinteractive' command, with 32 cores, 64gb RAM and 300gb of storage; sinteractive --cpus-per-task=32 --mem=64g --gres=lscratch:300 Once the interacive node is assigned, run the below command to load the cellranger module; # Change to the working directory cd /data/Shih_Lab/scRNAseqNilisha # Load the cellranger module module load cellranger After loading the cellranger module, run the below command to generate cell counts; cellranger multi --id=wttgbrain_hto_demultiplexed --csv=Protocol/multiplex_config.csv --jobmode=slurm --maxjobs=25 The multi is the subcommand to demultiplex based on HTO samples. --id specifies the 'wttgbrain_hto_demultiplexed' as a output folder (will be created new) --csv specifies the location of the multiplex_config.csv file (Protocol/multiplex_config.csv) --jobmode=slurm specifies that the job needs to be run in batch mode --maxjobs specifies the number of jobs allowed for this batch run (25 in our run) The cellranger multi runs for a few hours to complete. Once the run is complete, the output files are available in the outs/per_sample_outs folder within the 'wttgbrain_hto_demultiplexed' directory specified in the step #5 . A preliminary Report with the count summary, alignment quality, some preliminary analysis are available in the per_sample_outs folder, within each of the sample folders. For example, this web_summary.html file is available in the per_sample_outs/Tg_B3 folder The matrix files that we will use in the downstream analysis in seurat is also available in the per samples folder.","title":"C. Cell count at individual mouse level"},{"location":"primary-analysis.html#d-cell-count-at-sample-level","text":"Prepare libraryTG.csv and libraryWT.csv files (these are comma separated text files) The libraryTG.csv describes the location of the fastq files folder for the TG sample, the corresponding sample types (Tg) and the library preparation type (gene expression or antibody capture) The libraryTG.csv for this run is located here in the Protocol folder Similarly, prepare the libraryWT.csv file for the WT sample. The contents of the libraryTG.csv file and libraryWT.csv are given below. Note Since we are going to the data only at the samples level (wt vs tg), we do not have to include the antibody capture information in this run, but we are including it just in case. fastqs,sample,library_type /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Barcode/,WT_Barcode,Antibody Capture /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/WT_Gex/,WT_Gex,Gene Expression fastqs,sample,library_type /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Barcode/,Tg_Barcode,Antibody Capture /data/Shih_Lab/scRNAseqNilisha/RawData/mkfastq-output/outs/fastq_path/HCJY2DRXY/Tg_Gex/,Tg_Gex,Gene Expression 2. Prepare a common feature_reference.csv file(this is a comma separated text file) The feature_reference.csv file describes the antibodies (hash tag) used to hash tag the individual mouse (like B1, B2 etc.), a name for the individual mouse (like WT_B1), and then the pattern R2,5PNNNNNNNNNN(BC) (this is specific to TotalSeq B protocol , the actual Tag barcode sequence and the feature type (antibody capture) The feature_reference.csv for this run is located here in the Protocol folder The contents of the feature_reference.csv file is given below. id,name,read,pattern,sequence,feature_type WT_B1,WT_B1,R2,5PNNNNNNNNNN(BC),ACCCACCAGTAAGAC,Antibody Capture WT_B2,WT_B2,R2,5PNNNNNNNNNN(BC),GGTCGAGAGCATTCA,Antibody Capture WT_B5,WT_B5,R2,5PNNNNNNNNNN(BC),CTTTGTCTTTGTGAG,Antibody Capture WT_B6,WT_B6,R2,5PNNNNNNNNNN(BC),TATGCTGCCACGGTA,Antibody Capture Tg_B3,Tg_B3,R2,5PNNNNNNNNNN(BC),CTTGCCGCATGTCAT,Antibody Capture Tg_B4,Tg_B4,R2,5PNNNNNNNNNN(BC),AAAGCATTCTTCACG,Antibody Capture Tg_B7,Tg_B7,R2,5PNNNNNNNNNN(BC),GAGTCTGCCAGTATC,Antibody Capture Tg_B8,Tg_B8,R2,5PNNNNNNNNNN(BC),TATAGAACGCCAGGC,Antibody Capture 3. Prepare the swarm file containing the commands for both the samples (WT and TG) This swarm file (saved as count.swarm ) is a text file with the below commands. The swarm file specifies the 'count' subcommand for cellranger, the output folder name (--id), path to the library file (--libraries), path to the reference transcriptome (--transcriptome), path to the feature reference file (--feature-ref), the expected number of cells (--expect-cells), the number of cores to use and the amount of memory to use. cellranger count --id=WTbrain --libraries=/data/Shih_Lab/scRNAseqNilisha/Protocol/libraryWT.csv --transcriptome=/fdb/cellranger/refdata-gex-mm10-2020-A --feature-ref=/data/Shih_Lab/scRNAseqNilisha/Protocol/feature_reference_WT.csv --expect-cells=6000 --localcores=28 --localmem=64 cellranger count --id=TGbrain --libraries=/data/Shih_Lab/scRNAseqNilisha/Protocol/libraryTG.csv --transcriptome=/fdb/cellranger/refdata-gex-mm10-2020-A --feature-ref=/data/Shih_Lab/scRNAseqNilisha/Protocol/feature_reference_TG.csv --expect-cells=6000 --localcores=28 --localmem=64 4. Change to the Tools directory using the below command cd /data/Shih_Lab/scRNAseqNilisha/Tools/ 5. Run the swarm job using the below command, specifying the swarm file name, memory (-g), threads (-t), scratch space (--gres) and the module cellranger; swarm -f count.swarm -g 64 -t 28 --gres=lscratch:200 --module cellranger Note Note down your job id. Check your job status using the \"jobload\" command or the squeue command; Note Replace the job id in the below command with your job id squeue --job 14354599 6. Extend the swarm job running time using the below command; Note Replace the job id in the below command with your job id newwall --jobid 13558558 --time 36:00:00 7. Output The cellranger count runs for a few hours to complete. Once the run is complete, the output files are available in the outs folder within the 'WTbrain' and 'TGbrain' directories specified in the swarm file. In this run we moved the WTbrain and TGbrain results folders to the Results folder . A preliminary Report with the count summary, alignment quality, some preliminary analysis are available in the respective outs folder in the web_summary.html file The respective clustering file (cloupe.cloupe) based on the preliminary analysis is also available in the 'outs' folder, to visualize and explore the t-SNE and UMAP data. The matrix files that we will use in the downstream analysis in seurat is also available in the 'outs' folder.","title":"D. Cell count at sample level"},{"location":"primary-analysis.html#e-combine-cell-counts-using-sample-level-counts-to-get-a-combined-loupe-file","text":"Prepare the aggr.csv file The aggr.csv is a comma separated text file. The aggr.csv lists the sample Id, path to the molecule_h5 file for each of the samples obtained from the Step D above (WT and TG) and the sample group (WT or TG) The aggr.csv file for this run is located in the Tools folder. The contents of aggr.csv for this run is given below. sample_id,molecule_h5,SampleGroup WT,/data/Shih_Lab/scRNAseqNilisha/Results/WTbrain/outs/molecule_info.h5,WT TG,/data/Shih_Lab/scRNAseqNilisha/Results/TGbrain/outs/molecule_info.h5,TG Login to biowulf and request an interactive node using the below 'sinteractive' command, with 32 cores, 64gb RAM and 300gb of storage; sinteractive --cpus-per-task=32 --mem=64g --gres=lscratch:300 Once the interacive node is assigned, run the below command to load the cellranger module; # Change to the working directory cd /data/Shih_Lab/scRNAseqNilisha # Load the cellranger module module load cellranger After loading the cellranger module, run the below command to combine the cell counts from WT and TG and generate the combined loupe file; cellranger aggr --id=WT_TG_combined --csv=Tools/aggr.csv The aggr is the subcommand to combine the sample counts from WT and TG results folders. --id specifies the 'WT_TG' as a output folder (will be created new) --csv specifies the location of the aggr.csv file (Tools/aggr.csv) The cellranger aggr runs for a few hours to complete. Once the run is complete, the output files are available in the outs folder within the 'WT_TG_combined' directory specified in the step #4 above . A preliminary Report with the count summary, alignment quality, some preliminary analysis are available in the web_summary.html file is available in the outs folder The combined loupe file is available in the count folder","title":"E. Combine Cell counts (using sample level counts), to get a combined loupe file"},{"location":"primary-analysis.html#software","text":"cellranger 6.0.0 R 4.0.5 mkdocs 1.1.2","title":"Software"},{"location":"primary-analysis.html#references","text":"fastq generation Demultiplex and count TotalSeq CellRanger Biowulf Swarm Biowulf","title":"References"},{"location":"quality-control.html","text":"A. Data Import B. Detecting Low Quality Cells C. Quality Control Plots D. Removing Low Quality Cells E. Software F. Reference","title":"Quality Control"},{"location":"quality-control.html#a-data-import","text":"","title":"A. Data Import"},{"location":"quality-control.html#b-detecting-low-quality-cells","text":"","title":"B. Detecting Low Quality Cells"},{"location":"quality-control.html#c-quality-control-plots","text":"","title":"C. Quality Control Plots"},{"location":"quality-control.html#d-removing-low-quality-cells","text":"","title":"D. Removing Low Quality Cells"},{"location":"quality-control.html#e-software","text":"","title":"E. Software"},{"location":"quality-control.html#f-reference","text":"","title":"F. Reference"}]}